# 需求分析（PRD）- Connections 页面

**版本**: 1.0
**状态**: Draft
**关联**: epic/index.md（总需求）

## 1. 概述
- 问题陈述: 用户希望了解亲密关系的动态，但同时需要隐私控制。
- 解决方案: Circle + Echoes 卡片流 + Ghost Mode 与隐私配置。
- 范围（包含）:
  - Circle 关系圈
  - Echoes 动态卡片
  - Sherlock 智能建议
  - Ghost Mode 与隐私设置
- 范围（不包含）:
  - 公开社交广场

## 2. 目标与成功指标
- 业务目标: 提升好友互动与留存。
- 用户目标: 低压力地了解好友动态与留下 Moments。
- 成功指标（KPIs）:
  - Echoes 点击率
  - Ghost Mode 使用率
  - 好友互动转化率

## 3. 用户与场景
- 目标用户/画像:
  - 亲密关系用户群
- 主要场景:
  - 查看好友最近 Echoes
  - 切换 Ghost Mode
- 边缘场景:
  - 无好友或无动态

## 4. 需求
### 4.1 功能性需求
- FR-1 Circle
  - 描述: 可视化展示亲密好友列表与状态。
  - 验收标准:
    - Given 用户进入 Connections, When Circle 可用, Then 显示头像与状态。
- FR-2 Echoes
  - 描述: 以卡片流展示好友活动摘要。
  - 验收标准:
    - Given Echoes 可用, When 向下滚动, Then 支持连续加载。
- FR-3 Sherlock 建议
  - 描述: 基于设备端智能提示互动建议。
  - 验收标准:
    - Given 有相关场景, When 建议触发, Then 显示可操作提示。
- FR-4 Ghost Mode
  - 描述: 一键切换隐身模式。
  - 验收标准:
    - Given 用户切换 Ghost Mode, When 状态更新, Then 提示并即时生效。
- FR-5 隐私配置
  - 描述: 近似位置分享与历史自动删除。
  - 验收标准:
    - Given 用户修改隐私设置, When 保存, Then 立即生效并可追溯。

### 4.2 非功能性需求
- 性能: Echoes 列表滑动流畅。
- 隐私: 默认保护位置精度。
- 可访问性: 切换控件可清晰识别。

## 5. 用户体验
- 关键用户流程:
  - 查看 Circle → 浏览 Echoes → 互动
  - Ghost Mode 开启/关闭
- 信息架构:
  - Header + Circle + Echoes + Ghost Mode
- 交互模型:
  - 卡片点击、开关切换
- 内容模型:
  - Echo（地点/时间/摘要）

## 6. 线框图（低保真）
- 线框 A [Connections]
```
┌─────────────────────────┐
│ Header: Connections      │
└─────────────────────────┘

┌─────────────────────────┐
│ Circle (Avatars)         │
└─────────────────────────┘

┌─────────────────────────┐
│ Echoes Card              │
│ Echoes Card              │
└─────────────────────────┘

┌─────────────────────────┐
│ Ghost Mode [On/Off]      │
│ Privacy Settings         │
└─────────────────────────┘
```
- 状态:
  - 空: 文案“这里还安静着”，主操作“邀请好友”，次操作“查看推荐”
  - 加载: 文案“正在整理好友足迹…” + Echoes 骨架卡片
  - 错误: 文案“动态暂时走丢了”，主操作“重试”，次操作“稍后再看”
- 备注: 隐私入口清晰可见

## 7. HIG 对齐
| 原则 | 需求映射 | 备注 |
| --- | --- | --- |
| 清晰 | Ghost Mode 入口明显 | 降低隐私焦虑 |
| 克制 | 卡片信息简洁 | 不喧宾夺主 |
| 层次 | Circle 与 Echoes 分区 | 信息分层 |
| 审美一致性 | 氛围与关系语义一致 | 亲密感 |
| 一致性 | 卡片与开关样式统一 | 跨页复用 |
| 直接操作 | 开关与卡片点击直达 | 操作直观 |
| 反馈 | 切换状态即时提示 | 透明可感知 |
| 隐喻 | Circle 表达关系亲密度 | 易理解 |
| 用户可控 | 隐私可调与可撤销 | 可信体验 |

## 8. 数据与分析
- 关键事件:
  - connections_open, echo_view
  - ghost_mode_toggle, privacy_setting_change

### 错误码与处理
| 错误码 | 场景 | 用户文案 | 行为 |
| --- | --- | --- | --- |
| CONNECTIONS_NET_UNAVAILABLE | 网络不可用 | “连接不到好友的足迹” | 主操作“重试”，次操作“稍后再看” |
| CONNECTIONS_FEED_FAIL | 动态加载失败 | “动态暂时走丢了” | 主操作“重试”，次操作“返回” |
| CONNECTIONS_PRIVACY_UPDATE_FAIL | 隐私设置失败 | “设置没保存好” | 主操作“重试”，次操作“保持当前” |
| CONNECTIONS_EMPTY | 无好友动态 | “这里还安静着” | 主操作“邀请好友”，次操作“查看推荐” |

## 9. 风险与应对
- 风险: 隐私误操作
  - 应对: 明确提示与可撤销

## 10. 依赖与约束
- 依赖: 关系链服务、隐私策略
- 约束: 地区隐私合规

## 11. 里程碑
- MVP: Circle + Echoes
- V1: Ghost Mode 与隐私配置
- Future: 更丰富互动

## 12. 开放问题
- Sherlock 建议触发规则如何定义？

## 13. 假设
- 好友关系链数据可用
