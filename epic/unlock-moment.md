# 需求分析（PRD）- Unlock Moment 页面

**版本**: 1.0
**状态**: Draft
**关联**: epic/index.md（总需求）

## 1. 概述
- 问题陈述: 用户需要在到达地点时获得明确引导与解锁仪式感。
- 解决方案: UWB 精确引导 + 多模态反馈完成解锁。
- 范围（包含）:
  - 触发通知入口
  - 距离引导与方向提示
  - 解锁按钮与成功反馈
- 范围（不包含）:
  - Moments 创建与编辑

## 2. 目标与成功指标
- 业务目标: 提升解锁成功率与体验满意度。
- 用户目标: 快速且明确地完成解锁。
- 成功指标（KPIs）:
  - 解锁完成率
  - 平均解锁时长
  - 解锁失败率

## 3. 用户与场景
- 目标用户/画像:
  - 收到解锁提醒的用户
- 主要场景:
  - 接近地点后解锁
- 边缘场景:
  - UWB 不可用
  - 信号抖动导致距离不稳

## 4. 需求
### 4.1 功能性需求
- FR-1 解锁入口
  - 描述: 通知或 Place View 进入解锁页面。
  - 验收标准:
    - Given 用户点击通知, When 页面打开, Then 显示距离引导。
- FR-2 精准引导
  - 描述: UWB 显示方向与距离，提供降级提示。
  - 验收标准:
    - Given 无 UWB, When 进入页面, Then 提供视觉与音频提示。
- FR-3 解锁动作
  - 描述: 满足距离后可解锁，触发动画与反馈。
  - 验收标准:
    - Given 距离满足阈值, When 用户点击解锁, Then 展示成功反馈。
- FR-4 失败与重试
  - 描述: 解锁失败可重试并提示原因。
  - 验收标准:
    - Given 解锁失败, When 用户重试, Then 维持引导与状态提示。

### 4.2 非功能性需求
- 性能: 引导反馈 <200ms。
- 可靠性: 距离抖动时稳定展示。
- 可访问性: 文字与音效提示清晰。

## 5. 用户体验
- 关键用户流程:
  - 通知 → 引导 → 解锁 → 成功反馈
- 信息架构:
  - Header + 距离指引 + 解锁按钮 + 状态提示
- 交互模型:
  - 触感/音效/视觉多模态反馈
- 内容模型:
  - 距离、方向、解锁状态

## 6. 线框图（低保真）
- 线框 A [Unlock Moment]
```
┌─────────────────────────┐
│ Header: Unlock Moment    │
│ [←]              [⋯]     │
└─────────────────────────┘

┌─────────────────────────┐
│ Distance + Direction     │
│ UWB Guidance             │
└─────────────────────────┘

┌─────────────────────────┐
│ [ Unlock ]               │
└─────────────────────────┘

┌─────────────────────────┐
│ Status / Feedback        │
└─────────────────────────┘
```
- 状态:
  - 空: 文案“正在寻找你的 Moment…”，次操作“返回”
  - 加载: 文案“校准中…慢慢靠近” + 动态指引
  - 错误: 文案“定位不稳定，先歇一会儿”，主操作“重试”，次操作“去设置/查看提示”
- 备注: 解锁动作与反馈强一致

## 7. HIG 对齐
| 原则 | 需求映射 | 备注 |
| --- | --- | --- |
| 清晰 | 距离与方向清晰 | 降低探索成本 |
| 克制 | 引导界面简洁 | 聚焦任务 |
| 层次 | 引导与按钮分区 | 结构清晰 |
| 审美一致性 | 动效与音效与氛围一致 | 仪式感 |
| 一致性 | 与 Place View 风格统一 | 连贯体验 |
| 直接操作 | 距离满足后操作可用 | 期待一致 |
| 反馈 | 解锁反馈明确 | 保持仪式感 |
| 隐喻 | “解锁”动作具象化 | 易理解 |
| 用户可控 | 支持取消与退出 | 可逆路径 |

## 8. 数据与分析
- 关键事件:
  - unlock_open, guidance_update
  - unlock_attempt, unlock_success, unlock_fail

### 错误码与处理
| 错误码 | 场景 | 用户文案 | 行为 |
| --- | --- | --- | --- |
| UNLOCK_LOC_DENIED | 位置权限被拒 | “需要位置权限才能解锁” | 主操作“去设置”，次操作“返回” |
| UNLOCK_UWB_UNAVAILABLE | UWB 不可用 | “无法精确引导，改用视觉提示” | 主操作“继续”，次操作“返回” |
| UNLOCK_SIGNAL_UNSTABLE | 定位不稳定 | “定位不稳定，先歇一会儿” | 主操作“重试”，次操作“查看提示” |
| UNLOCK_ACTION_FAIL | 解锁失败 | “解锁没成功，再试一次” | 主操作“重试”，次操作“退出” |

## 9. 风险与应对
- 风险: 引导不稳定影响体验
  - 应对: 平滑算法与降级提示

## 10. 依赖与约束
- 依赖: UWB、定位、通知系统
- 约束: 设备硬件差异

## 11. 里程碑
- MVP: 基础解锁流程
- V1: UWB 引导增强
- Future: 更沉浸的音效与触感

## 12. 开放问题
- 解锁阈值如何定义与调整？

## 13. 假设
- 设备支持基础定位能力
