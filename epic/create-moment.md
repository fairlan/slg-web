# 需求分析（PRD）- Create Moment 页面

**版本**: 1.0
**状态**: Draft
**关联**: epic/index.md（总需求）

## 1. 概述
- 问题陈述: 用户需要一种有仪式感且安全的方式在地点创建 Moment。
- 解决方案: 引导式创建流程，选择位置与 Artifact 类型并完成封存。
- 范围（包含）:
  - 位置选择
  - Artifact 选择（Time Capsule/AR Note/Gift）
  - 内容输入与确认
  - Seal 动画与完成提示
- 范围（不包含）:
  - Discover/Connections 浏览功能

## 2. 目标与成功指标
- 业务目标: 提升 Moments 创建完成率。
- 用户目标: 快速且有仪式感地完成创建。
- 成功指标（KPIs）:
  - 创建流程完成率
  - 创建时长
  - 不同 Artifact 使用占比

## 3. 用户与场景
- 目标用户/画像:
  - 希望留下地点记忆的用户
- 主要场景:
  - 选择地点并封存 Moment
  - 通过 Apple Pay 留下 Gift
- 边缘场景:
  - 相机/位置权限未授权
  - 支付失败或取消

## 4. 需求
### 4.1 功能性需求
- FR-1 位置选择
  - 描述: 支持地图/定位选择地点并确认。
  - 验收标准:
    - Given 用户进入创建页面, When 确认地点, Then 显示地点名称与坐标。
- FR-2 Artifact 选择
  - 描述: 提供 Time Capsule、AR Note、Gift 选项。
  - 验收标准:
    - Given 用户选择 Artifact, When 点击下一步, Then 进入对应输入界面。
- FR-3 内容输入
  - 描述: Time Capsule 支持视频；AR Note 支持绘制/文字；Gift 支持支付。
  - 验收标准:
    - Given 用户完成输入, When 提交, Then 显示预览与确认。
- FR-4 Seal 动画与确认
  - 描述: 以动效完成封存，提示成功。
  - 验收标准:
    - Given 封存完成, When 动画结束, Then 显示成功状态与分享入口。
- FR-5 权限与隐私设置
  - 描述: 支持可见范围与隐私提示。
  - 验收标准:
    - Given 用户设置可见范围, When 保存, Then 生效并可在 Vault 查看。

### 4.2 非功能性需求
- 性能: 创建过程交互响应 <200ms。
- 可靠性: 上传失败可重试。
- 安全: 礼物支付安全流程完整。
- 隐私: 默认最小化分享范围。

## 5. 用户体验
- 关键用户流程:
  - 选择地点 → 选择 Artifact → 输入内容 → Seal → 完成
- 信息架构:
  - Header + 位置卡片 + Artifact 选择 + 输入区 + CTA
- 交互模型:
  - 步进式流程 + 进度提示
- 内容模型:
  - Artifact（类型/内容/可见范围）

## 6. 线框图（低保真）
- 线框 A [Create Moment]
```
┌─────────────────────────┐
│ Header: Create Moment    │
│ [←]              [⋯]     │
└─────────────────────────┘

┌─────────────────────────┐
│ Location Picker          │
│ Map + Pin                │
└─────────────────────────┘

┌─────────────────────────┐
│ Artifact Selection       │
│ Time Capsule | AR | Gift │
└─────────────────────────┘

┌─────────────────────────┐
│ Content Input            │
│ Video / Draw / Pay       │
└─────────────────────────┘

┌─────────────────────────┐
│ [ Seal It ]              │
└─────────────────────────┘
```
- 状态:
  - 空: 文案“还差一步：先选地点/再选一个 Artifact”，主操作“选择位置/选择类型”
  - 加载: 文案“正在封存…请稍候” + 进度条，提供“取消上传/稍后继续”
  - 错误: 文案“封存未完成/支付未成功”，主操作“重试”，次操作“保存草稿/取消支付”
- 备注: 每一步都提供返回与取消

## 7. HIG 对齐
| 原则 | 需求映射 | 备注 |
| --- | --- | --- |
| 清晰 | 步进式流程与明确 CTA | 任务单一 |
| 克制 | 控件简洁 | 内容为主 |
| 层次 | 分步结构清晰 | 进度可见 |
| 审美一致性 | 仪式感动效与主题一致 | 情绪匹配 |
| 一致性 | 流程与输入样式统一 | 降低学习成本 |
| 直接操作 | 直接选择与编辑内容 | 直观操作 |
| 反馈 | 操作与支付状态即时反馈 | 减少焦虑 |
| 隐喻 | “封存”仪式增强记忆感 | 可感知 |
| 用户可控 | 可撤销与返回 | 提供退出路径 |

## 8. 数据与分析
- 关键事件:
  - moment_create_start, moment_location_confirm
  - artifact_select, content_submit
  - seal_complete, gift_pay_success

### 错误码与处理
| 错误码 | 场景 | 用户文案 | 行为 |
| --- | --- | --- | --- |
| CREATE_LOC_DENIED | 位置权限被拒 | “需要位置权限才能封存” | 主操作“去设置”，次操作“取消” |
| CREATE_UPLOAD_FAIL | 内容上传失败 | “封存未完成” | 主操作“重试”，次操作“保存草稿” |
| CREATE_PAY_FAIL | 礼物支付失败 | “支付未成功” | 主操作“重试”，次操作“取消支付” |
| CREATE_DRAFT_SAVE_FAIL | 草稿保存失败 | “草稿暂时存不下” | 主操作“重试”，次操作“放弃” |

## 9. 风险与应对
- 风险: 创建流程过长
  - 应对: 分步引导与进度提示
- 风险: 支付失败
  - 应对: 明确错误提示与重试

## 10. 依赖与约束
- 依赖: 地图/定位、相机、Apple Pay
- 约束: 权限拒绝需降级提示

## 11. 里程碑
- MVP: 位置选择 + Time Capsule
- V1: AR Note + Gift
- Future: 更多 Artifact 类型

## 12. 开放问题
- AR Note 是否需要保存可编辑？

## 13. 假设
- 用户愿意授权相机与位置权限
